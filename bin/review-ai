#!/bin/sh

# AI-powered git diff review script
# Usage: review-ai [custom_prompt]
# Reviews current git changes including new files using Claude AI

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
   echo "Error: Not in a git repository" >&2
   exit 1
fi

# Check if claude command is available
if ! command -v claude > /dev/null 2>&1; then
   echo "Error: 'claude' command not found" >&2
   exit 1
fi

# Add all changes including new files to staging area
git add .

# Check if there are any changes to review
if ! git diff --cached --quiet HEAD; then
   # Use custom prompt if provided, otherwise use default
   PROMPT="${1:-git diff から現在の編集内容を確認し、レビューしてください}"

   # Get the diff and pass it to claude
   git diff HEAD | claude -p "$PROMPT"
else
   echo "No changes to review." >&2
   exit 0
fi

